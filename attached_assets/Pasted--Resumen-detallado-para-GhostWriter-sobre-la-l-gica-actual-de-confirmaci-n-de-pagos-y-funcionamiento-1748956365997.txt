
Resumen detallado para GhostWriter sobre la lÃ³gica actual de confirmaciÃ³n de pagos y funcionamiento de la secciÃ³n Payroll

âœ… FLUJO OPERATIVO ACTUAL:

1. Se genera una nÃ³mina desde el frontend.
2. Esto crea registros en la tabla `payroll`, uno por cada empleado incluido en la nÃ³mina generada.
3. En el frontend, se puede hacer clic en â€œConfirmar pagoâ€ para cada empleado.
4. Al hacerlo, se muestra una opciÃ³n para registrar el pago de:
   - Solo en mano (cash)
   - Solo en banco (bank)
   - Ambos
   - âš ï¸ Uno de los dos (mano o banco) puede estar en cero, pero no ambos.
5. Una vez registrado el pago (al menos uno de los dos > 0), el sistema deberÃ­a:
   - âœ… Actualizar los campos `is_paid_hand` y `is_paid_bank` en la tabla `payroll` segÃºn corresponda.
   - âœ… Insertar la `hand_payment_date` y/o `bank_payment_date` segÃºn corresponda.
   - âœ… Cuando ambos pagos estÃ¡n realizados, se deberÃ­a actualizar el campo `is_paid` a `true`.
   - âœ… Finalmente, eso debe hacer que ese registro se mueva al historial de pagos en el frontend.

ğŸ§  SUPUESTAS LÃ“GICAS CLAVE:

- is_paid_hand = true â†’ cuando se confirma un pago en mano.
- is_paid_bank = true â†’ cuando se confirma un pago por banco.
- is_paid = true â†’ cuando ambos anteriores son true.
- Estos campos ya existen en la tabla `payroll` segÃºn la estructura confirmada por el usuario.

âš ï¸ Errores actuales:

- El sistema tira error si alguno de los valores (mano o banco) estÃ¡ en cero. Pero esto deberÃ­a estar permitido.
- En algunos casos, parece debitar correctamente del total a pagar, pero no se registra en `payroll_details`.
- El historial en el frontend no muestra los pagos realizados (aunque pudieron haber afectado el total general).
- La tabla `payroll_details` estÃ¡ vacÃ­a aÃºn cuando se confirma un pago.

ğŸ“¦ TABLAS INVOLUCRADAS Y SU ESTRUCTURA:

TABLA: payroll
- is_paid_hand: boolean
- is_paid_bank: boolean
- is_paid: boolean
- hand_payment_date: timestamp
- bank_payment_date: timestamp
- Otros campos como: hand_salary, bank_salary, total_salary, deductions, additions, etc.

TABLA: payroll_details
- Cuando se confirma un pago, se deberÃ­a crear un registro acÃ¡.
- Campos clave: payroll_id, type (por ejemplo â€œBancoâ€ o â€œManoâ€), concept (por ejemplo â€œPago nÃ³minaâ€), amount, date.

TABLA: pending_liquidations
- No entra en esta lÃ³gica, se usarÃ¡ en la siguiente fase.

ğŸ›‘ IMPORTANTE:
La parte de generaciÃ³n de nÃ³mina y cÃ¡lculo actual FUNCIONA correctamente. Los valores se calculan bien y el frontend los muestra bien.

â›” A partir de ahora, NO MODIFICAR ninguna funcionalidad previa de generaciÃ³n de nÃ³mina.

âœ… Todo lo nuevo debe centrarse en:
1. ConfirmaciÃ³n de pagos
2. Registro correcto en payroll_details
3. Mostrado correcto en historial del frontend

ğŸ›Ÿ Si GhostWriter necesita confirmar cÃ³mo se arma alguna tabla o campo, se puede pedir el SQL directamente.

El usuario estÃ¡ disponible para responder dudas especÃ­ficas sobre la estructura o la lÃ³gica que no quede clara.
